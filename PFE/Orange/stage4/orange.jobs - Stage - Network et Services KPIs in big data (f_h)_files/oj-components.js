var ojSession={};if(window.location.pathname.indexOf("/app/"))$('body').addClass("app");(function(){$(window).on('digital:stateChange',function(event,state){var lastPage=_.last(state);if(lastPage){var $page=lastPage.$element;var url=$page.data('url');var isStats=((typeof _gaq!='undefined')&&(url!=null));if(isStats){var siteCode=$page.data('site')||false;var channelCode=$page.data('channel')||false;var subjectCode=$page.data('subject')||false;var chapterCode=$page.data('chapter')||false;var aliasCode=$page.data('alias')||false;if(siteCode)_gaq.push(['_setCustomVar',1,'ga_w',siteCode,3]);if(channelCode)_gaq.push(['_setCustomVar',2,'ga_c',channelCode,3]);if(subjectCode)_gaq.push(['_setCustomVar',3,'ga_s',subjectCode,3]);if(chapterCode)_gaq.push(['_setCustomVar',4,'ga_r',chapterCode,3]);if(aliasCode)_gaq.push(['_setCustomVar',5,'ga_p',aliasCode,3]);_gaq.push(['_trackPageview'],url);}}});$(window).on('digital:stateChange',function(event,state){var lastPage=_.last(state);if(lastPage){var $page=lastPage.$element;var url=$page.data('url');var isStats=((typeof window.intrametrics!='undefined')&&(url!=null));if(isStats){var pageTitle=$page.data('title')||'';var staturl="http://collecteur-imc.si.francetelecom.fr/cgi-bin/witbe_tag.pl?"+"wc="+intrametrics+"&tag="+intrametrics+"&Rdm="+Math.random()+"&Referrer="+"&NomSite=Jobsmap&Page="+escape(pageTitle)+"&Rubrique="+escape("jobsmap");$page.append('<img class="intrametrics" src="'+staturl+'" width="1" height="1" />');}}});$(window).on('digital:contentReady',function(event,container){var $container=$(container);$container.on('mouseup','a',function(event){var isStats=(typeof _gaq!='undefined');var $this=$(this);var href=$this.attr('href');if(!href||href==""||href.indexOf('javascript')!=-1||href[0]=='#')return;var href_lower=href.toLowerCase();var typelink=false;var link=false;var host=location.host;if(href_lower.length>=6&&href_lower.substr(0,6)=="mailto"){typelink='Mail';link=href.substring(7);}if(href_lower.length>=4&&href_lower.substr(0,4)=="http"){var domain=document.domain.replace("www.",'');if(href_lower.indexOf(domain)==-1){typelink='External';link=href;}if(($this.hasClass('video'))||$this.hasClass('tile')){typelink='Video';link=href;}var isDoc=href_lower.match(/(?:pdf|xls|doc|ppt|eps|vsd|csv|zip|rar)($|\&)/);if(isDoc)typelink='Documents';if(isDoc){link=href_lower;var ind1=link.lastIndexOf("/");if(ind1!=-1){link=link.substring(0,ind1);ind1=link.lastIndexOf("/");link=link.substring(ind1+1);}}else{if(!typelink)typelink="link";link=href;}if(typelink){if(isStats)_gaq.push(['_trackEvent',typelink,link]);}}});$container.find('[data-track="social"]').each(function(i,socialitem){var isStats=(typeof _gaq!='undefined');$(socialitem).on("click",function(){if(isStats)_gaq.push(['_trackSocial',$(socialitem).data("track-code"),'share']);});});});})();(function(){$(window).on('digital:contentReady',function(event,node){if($(node).find('#session:not(.connected)').length)initLogin();});})();(function(){$(window).on('digital:contentReady',function(event,node){$(node).find('.profileComponent').each(function(i,component){var $profileContainer=$(component);if($profileContainer.find("#profileitemEmpty").length)$profileContainer.removeClass("hasTitle");else
$profileContainer.addClass("hasTitle");});});})();(function(){$(window).on('digital:contentReady',function(event,node){$(node).find('#quest_window').each(function(i,quest){init_questionnaire($(quest));});});})();(function(){$(window).on('digital:contentReady',function(event,node){$(node).find('ul.slider').each(function(i,slider){$(slider).bkSlider({maxWidthMultiplier:1.4});});});})();(function(){$(window).on('digital:contentReady',function(event,node){$(node).find('#menu').each(function(i,menu){if($(menu).find('a.callmenu').length){var url=$(menu).find('a.callmenu').attr('href');var menucontainer=$(menu).find('ul.dgt-menu li').eq(0);menucontainer.load(url);}});});})();(function(){$(window).on('digital:contentReady',function(event,node){$(node).find('.ajaxform').each(function(i,elem){$(elem).submit(function(e){e.preventDefault();e.stopPropagation();var url=e.attr("action");var params=e.serialize();var isready=true;if(e.bkValidation()){if(e.data("ckoictzig")&&e.data("ckoictzig").length()){var ckoictzigurl=e.data("ckoictzig");var errormessageckoictzig=e.data("errormessageckoictzig");var mesckoictzig=errormessageckoictzig+" ("+$myform.find('[name*="ckoictzig"]').val()+")";var ajaxRequest=$.ajax({type:'POST',url:ckoictzigurl,data:params,success:function(request){if(request.length>1&&request.charAt(0)=='O'&&request.charAt(1)=='K'){}else{alert(mesckoictzig);isready=false;}},error:function(request){isready=false;alert(mesckoictzig);}});}if(isready){$.ajax({type:'POST',url:url,data:params,success:function(request){closeExtModal();},error:function(request){closeExtModal();}});}}});});});})();(function(){$(window).on('digital:contentReady',function(event,node){$(node).find('.dgt-list .dgt-section-body, .dgt-tiles .dgt-section-body').each(function(i,elem){$elem=$(elem);$elem.find('.block').each(function(i,block){$(block).contents().unwrap();});$elem.contents().unwrap();});$(node).find('.dgt-flex .dgt-section-body').each(function(i,elem){$(elem).contents().unwrap();});});})();(function(){$(window).on('digital:contentReady',function(event,node){$(node).find('.dgt-tabs-head').each(function(i,elem){$elem=$(elem);var flag=true;$elem.find('a').each(function(i,tab){var tab=$(tab);if($('#'+tab.data('id')).length){var target=$('#'+tab.data('id')).eq(0);var tabparent=tab.closest('li');if(flag){target.show();tabparent.addClass('selected');flag=false;}tab.click(function(){target.siblings().hide();target.show();tabparent.siblings('li').removeClass('selected');tabparent.addClass('selected');});}});});});})();(function(){$(window).on('digital:contentReady',function(event,node){if($(node).find('.twitter-component').length){if(window.twttr)window.twttr.widgets.load();}});})();(function(){$(window).on('digital:contentReady',function(event,node){if($(node).find('.composant.HappyTrainees').length){if(typeof window.Mentreprises!="undefined")window.mentreprisesAsyncInit();}});})();(function(){$(window).on('digital:contentReady',function(event,node){var $node=$(node);$node.find('.dgt-sector').each(function(i,node){new Dgt_Sector(node);});});var Dgt_Sector=function(){this.initialize.apply(this,arguments);};$.extend(Dgt_Sector.prototype,{initialize:function(view){this.uid=_.uniqueId('digital-');this.$view=$(view).data('Dgt_Sector',this);this.$page=this.$view.closest('.page,#head');this.$percent=this.$view.data('value')||0;this.$size=this.$view.data("size")||200;this.$stroke=this.$view.data("stroke")||20;this.$svg=this.$view.find('.dgt-sector-svg').first();this.sektor=new Sektor('.dgt-sector-svg',{size:this.$size,stroke:this.$stroke,arc:true,angle:this.$percent*(360/100),sectorColor:'#ff7700',circleColor:'#ffd200',fillCircle:false});},dispose:function(){$(document.body).off('.'+this.uid);},});})();(function(){$(window).on('digital:contentReady',function(event,node){var $node=$(node);$node.find('.dgt-home-profile').each(function(i,node){new Dgt_Home_Profile(node);});});var Dgt_Home_Profile=function(){this.initialize.apply(this,arguments);};$.extend(Dgt_Home_Profile.prototype,{initialize:function(view){this.uid=_.uniqueId('digital-');this.$view=$(view).data('Dgt_Home_Profile',this);this.$flexFill=this.$view.closest('.dgt-flex-fill');this.$page=this.$view.closest('.page,#head');this.$list=this.$view.find('.profile-offers-list');this.$items=this.$list.find('li');this.isOpened=false;this.$list.css('overflow','hidden');this.$view.find('.more a').on('click',$.proxy(this.more_clickHandler,this));this.invalidateHeight=_.debounce(this.invalidateHeight,20);$(window).on('resize.'+this.uid,$.proxy(this.invalidateHeight,this));this.invalidateHeight();},more_clickHandler:function(event){event.preventDefault();event.stopPropagation();this.isOpened?this.close():this.open();},open:function(){this.isOpened=true;this.$list.css('height','');this.$view.addClass('is-opened');},close:function(){this.isOpened=false;this.$view.removeClass('is-opened');this.invalidateHeight();},invalidateHeight:function(){if(this.isOpened)return;var viewHeight=this.$view.height();var marginTop=this.$list.offset().top-this.$view.offset().top;var marginBottom=40;var maxHeight=viewHeight-marginTop-marginBottom;var height=0;var minHeight=0;var calcHeight=0;var numItems=0;this.$items.each(function(i,item){calcHeight+=$(item).outerHeight();if(i<=1)minHeight=calcHeight;if(i>=1&&calcHeight>maxHeight)return false;height=calcHeight;numItems++;});this.$list.css('height',height+1);},dispose:function(){$(window).off('.'+this.uid);},});})();(function(){$(window).on('digital:contentReady',function(event,node){$(node).find('.alert-card').each(function(i,elem){var isGoogleMaps=true;if(window.Microsoft&&window.Microsoft.Maps){isGoogleMaps=false;}var $this=$(this);var latmin=$this.attr('data-latmin');if(latmin!=""){if(isGoogleMaps){var sw=new google.maps.LatLng($this.attr('data-latmin'),$this.attr('data-lgmin'));var ne=new google.maps.LatLng($this.attr('data-latmax'),$this.attr('data-lgmax'));var bounds=new google.maps.LatLngBounds(sw,ne);var center=bounds.getCenter();var src=document.location.protocol+"//maps.googleapis.com/maps/api/staticmap?sensor=true&key=AIzaSyDyEBxArlkqloojZF83P8-c_vLW5ft8U4c&zoom=10&size=400x220&center="+center;}else{var src="//dev.virtualearth.net//REST/V1/Imagery/Map/road";src+="?mapArea="+$this.attr('data-latmin')+","+$this.attr('data-lgmin')+","+$this.attr('data-latmax')+","+$this.attr('data-lgmax');src+="&ms=250,180";src+="&key="+window.BING_MAPS_KEY;}var $img=$('<img class="map" src="'+src+'"/>');$img.appendTo($this.find('.map-card'));}});});})();(function(){$(window).on('digital:contentReady',function(event,node){$(node).find('.maproute').each(function(i,elem){var $elem=$(elem);var isGoogleMaps=true;if(window.Microsoft&&window.Microsoft.Maps){isGoogleMaps=false;}var mapcontent=$elem.find("#mapcontent")[0];var lat=$elem.data("lat");var lng=$elem.data("lng");var directionsDisplay;var map;var center=false;if(isGoogleMaps){var directionsService=new google.maps.DirectionsService();directionsDisplay=new google.maps.DirectionsRenderer();center=new google.maps.LatLng(lat,lng);var mapOptions={zoom:17,minZoom:1,maxZoom:21,mapTypeControl:false,panControl:false,streetViewControl:false,center:center}
map=new google.maps.Map(mapcontent,mapOptions);directionsDisplay.setMap(map);var marker=new google.maps.Marker({map:map,position:center,draggable:false,clickable:false,icon:'../images2/map/1mini-goutte.png',width:36,height:35});}else{var mapOptions={credentials:window.BING_MAPS_KEY,mapTypeId:Microsoft.Maps.MapTypeId.road,zoom:15,center:new Microsoft.Maps.Location(lat,lng)}
var map=new Microsoft.Maps.Map(mapcontent,mapOptions);map.entities.clear();var pushpin=new Microsoft.Maps.Pushpin(map.getCenter(),null);map.entities.push(pushpin);Microsoft.Maps.loadModule('Microsoft.Maps.Directions');}$("#showroute").click(function(){showroute();});$("#getdirections").submit(function(){showroute();return false;});function showroute(){var start=$elem.find('#directionsStart')[0].value;var end=$elem.find('#directionsStop')[0].value;if(isGoogleMaps){var request={origin:start,destination:center,travelMode:google.maps.DirectionsTravelMode.DRIVING,unitSystem:google.maps.UnitSystem.METRIC};directionsService.route(request,function(response,status){if(status==google.maps.DirectionsStatus.OK){directionsDisplay.setDirections(response);var route=response.routes[0];var summaryPanel=$elem.find('#directions_panel')[0];summaryPanel.innerHTML='';for(var i=0;i<route.legs.length;i++){var routeSegment=i+1;summaryPanel.innerHTML+=route.legs[i].start_address+' -> ';summaryPanel.innerHTML+=route.legs[i].end_address+' -> ';summaryPanel.innerHTML+=route.legs[i].distance.text+'<br><br>';}}});}else{var directionsManager=new Microsoft.Maps.Directions.DirectionsManager(map);directionsManager.clearDisplay();directionsManager.resetDirections();directionsManager.setRequestOptions({distanceUnit:Microsoft.Maps.Directions.DistanceUnit.kilometers,routeMode:Microsoft.Maps.Directions.RouteMode.driving});var startPoint=new Microsoft.Maps.Directions.Waypoint({address:start});directionsManager.addWaypoint(startPoint);var endPoint=new Microsoft.Maps.Directions.Waypoint({location:new Microsoft.Maps.Location(lat,lng)});directionsManager.addWaypoint(endPoint);Microsoft.Maps.Events.addHandler(directionsManager,'directionsUpdated',displayDistanceAndTime);directionsManager.calculateDirections();function displayDistanceAndTime(e){$('#directions_panel').html("<strong>Distance: </strong>"+parseInt(e.routeSummary[0].distance)+" km"+" | <strong>Temps: </strong>"+parseInt(e.routeSummary[0].time/60)+" minutes");}}}});});})();(function(){$(window).on('digital:contentReady',function(event,node){$(node).find('.file-container').each(function(i,elem){var $container=$(elem);var $upload=$container.find('.file-upload');var $view=$container.find('.file-view');var $preview=$container.find('.file-preview');var $info=$view.find('.info');var $date=$info.find('.date');var $origin=$info.find('.origin');var $writeinline=$container.find('.writeinline');var $progressbar=$('#progressbar');var $errors=$('#_errors');$progressbar.hide();var $progressbarcontent=$progressbar.find('.content');var progressbarcontent=$progressbarcontent.html();var fieldname=$container.attr('data-fieldname');var name=$container.attr('data-name');var $name=$container.find('input[name='+name+']');var $originfield=$('#origin');var $originfieldcv=$('#cvorigin');var url='/jobs/jobapply.do?filetype='+fieldname;var NOK='NOK';var tmpdate=new Date();var dd=tmpdate.getDate();var mm=tmpdate.getMonth()+1;var yyyy=tmpdate.getFullYear();if(dd<10){dd='0'+dd};if(mm<10){mm='0'+mm};var today=dd+'/'+mm+'/'+yyyy;$container.find('input[type=file]').fileupload({dataType:'json',progressall:function(e,data){var progress=parseInt(data.loaded/data.total*100,10);$progressbarcontent.css('width',progress+'%').html(progressbarcontent+'&nbsp;'+progress+'%');},change:function(e,data){$progressbar.appendTo($container);$progressbar.show();$upload.hide();data.url=url+'&do=upload';},add:function(e,data){data.submit();},done:function(e,data){$progressbarcontent.css('width','0%');$progressbar.hide();var status=data&&data.result&&data.result.status?data.result.status:NOK;if(status==NOK){var errorMsg='';if($errors){var errorCode=data.result.errorCode;var $msg=$errors.find('.'+errorCode);if($msg.length)errorMsg=$msg.html();}if(errorMsg==''){if(data&&data.result&&data.result.errorMsg)errorMsg=data.result.errorMsg;else errorMsg='upload error';}$upload.show();alert(errorMsg);}else{$view.show();$date.html(today);$origin.html(data.result.name+' ['+data.result.size+' o]');$name.val(data.result.name);$originfield.val('');}},error:function(error,data){alert('error='+error);}});$container.find('.file-change').on('click',function(e){e.preventDefault();e.stopPropagation();$view.hide();$upload.show();$date.html('');$origin.html('');$name.val('');var textname=$container.attr('data-textname');if(textname)$container.find('textarea[name='+textname+']').html('');$progressbar.hide();$progressbarcontent.css('width','0%');$.ajax({url:url+'&do=delete',dataType:'json',success:function(request){},error:function(request){}});});$preview.on('click',function(e){e.preventDefault();e.stopPropagation();var errorMsg='preview error';$.ajax({url:url+'&do=view',type:'POST',dataType:'json',data:$("#applyForm").serialize(),success:function(request){var status=request&&request.status?request.status:NOK;if(request&&request.errorMsg)errorMsg=request.errorMsg;if(status==NOK||!request.url)alert(errorMsg);else{self.location=request.url;}},error:function(request){alert(errorMsg);}});});$writeinline.on('click',function(e){e.preventDefault();e.stopPropagation();$(this).hide();$container.find('.filetext').show();});$container.find('.cvgenerate').on('click',function(e){e.preventDefault();e.stopPropagation();$upload.hide();var origin=$(this).attr('data-origin');var errorMsg="La publication de votre CV n'a pas pu s'effectuer - Sorry, Your CV publication has failed";$.fancybox('<div class="message-loading"><span class="loading mini"></span><p>'+$('.inprogress').html()+'</p></div>',{width:'450',height:'30',autoSize:false});$.ajax({url:url+'&do=generate&origin='+origin+'&joid='+$('#joid').val(),dataType:'json',type:'POST',data:$("#applyForm").serialize(),success:function(request){var status=request&&request.status?request.status:NOK;var errorCode=request&&request.errorCode?request.errorCode:'';if(errorCode!='')errorCode=errorCode.toLowerCase();if(request&&request.errorMsg)errorMsg=request.errorMsg+' ['+errorCode+']';if(status==NOK){if($errors){var $msg=$errors.find('.'+errorCode);if($msg.length)errorMsg=$msg.html();}if(origin=='linkedin'||origin=='orangecloud'||origin=='googledrive'||origin=='dropbox'){self.location=request.url;}else if(errorCode=='authenticationneeded'&&request.url){if(confirm(errorMsg))self.location=request.url;else{$.fancybox.close();$upload.show();}}else if(errorCode=='alreadyauthenticated'&&request.url){$.fancybox.close();self.location=request.url;}else{if($errors){var $msg=$errors.find('.'+errorCode);if($msg.length)errorMsg=$msg.html();}$.fancybox.close();$upload.show();alert(errorMsg);}}else{$.fancybox.close()
$view.show();$date.html(today);if(request.reference&&request.reference!=""){$origin.html(request.reference);$originfieldcv.val(request.reference);}else
$origin.html(request.name+' ['+request.size+' o]');$name.val(request.name);$originfield.val(origin);}},error:function(request){if(origin=='linkedin')self.location='/jobs/jobapply.do?do=testpage';else{$.fancybox.close();$upload.show();alert(errorMsg);}}});});$container.find('.cloudletter').on('click',function(e){e.preventDefault();e.stopPropagation();$upload.hide();var origin=$(this).attr('data-origin');var errorMsg="Le telechargement de votre lettre n'a pas pu s'effectuer - Sorry, the downloading of your letter has failed";$.fancybox('<div class="message-loading"><span class="loading mini"></span><p>'+$('.inprogress').html()+'</p></div>',{width:'450',height:'30',autoSize:false});$.ajax({url:url+'&do=cloudletter&origin='+origin+'&joid='+$('#joid').val(),dataType:'json',type:'POST',data:$("#applyForm").serialize(),success:function(request){var status=request&&request.status?request.status:NOK;var errorCode=request&&request.errorCode?request.errorCode:'';if(errorCode!='')errorCode=errorCode.toLowerCase();if(request&&request.errorMsg)errorMsg=request.errorMsg+' ['+errorCode+']';if(status==NOK){if($errors){var $msg=$errors.find('.'+errorCode);if($msg.length)errorMsg=$msg.html();}if(origin=='linkedin'||origin=='orangecloud'||origin=='googledrive'||origin=='dropbox'){self.location=request.url;}else if(errorCode=='authenticationneeded'&&request.url){if(confirm(errorMsg))self.location=request.url;else{$.fancybox.close();$upload.show();}}else if(errorCode=='alreadyauthenticated'&&request.url){$.fancybox.close();self.location=request.url;}else{if($errors){var $msg=$errors.find('.'+errorCode);if($msg.length)errorMsg=$msg.html();}$.fancybox.close();$upload.show();alert(errorMsg);}}else{$.fancybox.close()
$view.show();$date.html(today);$origin.html(request.name+' ['+request.size+' o]');$name.val(request.name);$originfield.val(origin);}},error:function(request){if(origin=='linkedin')self.location='/jobs/jobapply.do?do=testpage';else{$.fancybox.close();$upload.show();alert(errorMsg);}}});});});});})();(function(){$(window).on('digital:contentReady',function(event,node){$node=$(node);$tagUrl=$node.data("read-tag");if($tagUrl){setTimeout(function(){var $isMobile=($('body').hasClass('lyt-mo')?true:false);var $doc=$(document);var $startPosition=($isMobile?$doc.scrollTop():$doc.scrollLeft());$doc.one('scroll',function(){var $newPosition=($isMobile?$doc.scrollTop():$doc.scrollLeft());if($newPosition>$startPosition){$node.xhr=$.ajax({url:$tagUrl});}});},1000);}});})();$(document).ready(function(){$("body").find('.cookie-popin').each(function(i,elem){var $elem=$(elem);if($.cookie("ag")==1){$elem.hide();}$elem.find(".icon").each(function(i,cross){$(cross).on('click',function(e){$.cookie("ag",1,{path:'/',expires:100});$elem.hide();});});});});(function(){$(window).on('digital:contentReady',function(event,node){var $node=$(node);$node.find('.dgt-quest').each(function(i,node){new Dgt_Quest(node);});});function resetFormElements(node){$(node).find(':input').each(function(){if(this.type=='text'||this.type=='textarea')this.value='';else if(this.type=='radio'||this.type=='checkbox')this.checked=false;else if(this.type=='select-one'||this.type=='select-multiple')this.value='';});};function showNext(node){$(node).find('.dgt-quest-next').each(function(i,e){$(e).addClass("visible");});};function hideNext(node){$(node).find('.dgt-quest-next').each(function(i,e){$(e).removeClass("visible");});};function questionValidate(s){var $s=$(s);var o={failedClass:'validation-failed',passedClass:'validation-passed',divClass:'validation-advice'}
$s.find('.'+o.divClass).remove();var isValable=true;for(var i=0;i<=validationRules.length-1;i++){$s.find('.'+validationRules[i][0]).each(function(index){var $elm=$(this);var val=$elm.val();if(!(validationRules[i][2](val,$elm))){if(!$elm.hasClass(o.failedClass))$elm.addClass(o.failedClass);var id='advice-'+validationRules[i][0]+'-'+$elm.attr('id');var $label=$elm.parent();$label.prepend('<span class="'+o.divClass+'" id="'+id+'">'+validationRules[i][1]+'</span>');isValable=false;$elm.on('focus',function(){$('#'+id).remove();});$elm.on('change',function(){$('#'+id).remove();});$elm.on('click',function(){$('#'+id).remove();});}else{if(!$elm.hasClass(o.passedClass))$elm.addClass(o.passedClass);if($elm.hasClass(o.failedClass))$elm.removeClass(o.failedClass);}});}if(!isValable)$('.'+o.divClass).on('click',function(){$(this).remove();});return isValable;};var Dgt_Quest=function(){console.log('new Dgt_Quest()');this.initialize.apply(this,arguments);};$.extend(Dgt_Quest.prototype,{initialize:function(view){this.uid=_.uniqueId('digital-');this.$view=$(view).data('Dgt_Quest',this);this.$page=this.$view.closest('.page,#head');this.$questions=this.$view.find('.dgt-quest-question');this.nbq=this.$questions.length;this.$paginate=!this.$view.data("qtype")||(this.$view.data("qtype")==="multiple");if(!this.$paginate)this.$view.find('.dgt-quest-next').last().removeClass("dgt-quest-next").addClass("dgt-quest-submit");if(ieVersion===8||ieVersion===7){this.$page.addClass("ie8");this.$page.on('click','label',$.proxy(function(event){var id=$(event.currentTarget).attr('for');var $checkbox=this.$view.find(':checkbox#'+id+':eq(0),:radio#'+id+':eq(0)');if($checkbox.length&&!$checkbox.is(':visible')){$checkbox.trigger('click').trigger('change');}},this));}this.$form=this.$view.find('form');this.$form.on('submit',$.proxy(this.form_submitHandler,this));this.$form.on('change',':checkbox,:radio',$.proxy(this.check_changeHandler,this));this.$form.on('change','select',$.proxy(this.select_changeHandler,this));this.$form.on('keyup','input[type=text],textarea',$.proxy(this.inputText_changeHandler,this));this.$form.on('click','.dgt-quest-next a',$.proxy(this.button_nextHandler,this));this.$form.on('click','.dgt-quest-submit a',$.proxy(this.form_submitHandler,this));this.initSelect();this.initShowQuestions();var layout=$(document.body).on('layout:change.'+this.uid,$.proxy(this.invalidateLayout,this)).data('layout');if(layout)this.invalidateLayout(null,layout);},dispose:function(){$(document.body).off('.'+this.uid);},invalidateLayout:function(event,layout){this.isMobile=layout==='MobileLayout';this.isHorizontal=layout==='HorizontalLayout';},initShowQuestions:function(){this.$paginate?this.$questions.first().addClass("visible"):this.refresh_questions();},form_submitHandler:function(event){event.preventDefault();var isValid=true;this.$form.find(".dgt-quest-question.visible").each(function(i,q){if(questionValidate($(q))===false){isValid=false};});if(isValid)this.loadData();},getFormUrl:function(){return this.$form.attr('action');},getFormData:function(override){var data=this.$form.serializeArray();if(override)_.each(override,function(value,name){var param=_.findWhere(data,{name:name});if(!param)data.push(param={name:name});param.value=value;},this);return data;},loadData:function(){if(this.jqXHR)this.jqXHR.abort();this.jqXHR=$.ajax({url:this.getFormUrl(),type:'post',dataType:'text',data:this.getFormData(),context:this,beforeSend:function(jqXHR,settings){jqXHR.__settings=settings;}});this.jqXHR.done(this.loadData_doneHandler);this.jqXHR.fail(this.loadData_failHandler);this.jqXHR.always(this.loadData_alwaysHandler);},loadData_doneHandler:function(data,textStatus,jqXHR){if(data=="OK"){this.$view.find(".dgt-quest-question").not(".dgt-quest-epilog").removeClass("visible");this.$view.find(".dgt-quest-epilog").addClass("ok").removeClass("ko");}else{this.$view.find(".dgt-quest-question").not(".dgt-quest-epilog").removeClass("visible");this.$view.find(".dgt-quest-epilog").addClass("ko").removeClass("ok");}},loadData_failHandler:function(jqXHR,textStatus,errorThrown){console.log(textStatus);},loadData_alwaysHandler:function(data){this.jqXHR=null;},initSelect:function(){this.$form.find('select').each(function(i,s){$s=$(s);var options=$s.find("option");if(options.length>9){var arr=options.map(function(_,o){return{t:$(o).text(),v:o.value,c:$(o).data('code')};}).get();arr.sort(function(o1,o2){return o1.t>o2.t?1:o1.t<o2.t?-1:0;});options.each(function(i,o){o.value=arr[i].v;$(o).text(arr[i].t);$(o).attr("data-code",arr[i].c);});}$s.prepend("<option class='init-option' value='' selected>--------</option>");$s.val('');});},button_applyHandler:function(event){event.preventDefault();event.stopPropagation();var $button=$(event.currentTarget);},button_nextHandler:function(event){event.preventDefault();event.stopPropagation();var $button=$(event.currentTarget);var $currentQuestion=$button.closest(".dgt-quest-question");$f=this.$form;if(questionValidate($currentQuestion)===true){var $nextquestions=$currentQuestion.nextAll(".dgt-quest-question");if(this.$paginate&&($nextquestions.length>0)){$currentQuestion.removeClass("visible");$f=this.$form;$nextquestions.each(function(i,question){$question=$(question);$conditions=$question.data("condition");var conditionFullfilled=false;if($conditions&&($conditions.length>0)&&($conditions.charAt(0)!="$")){var conditionslist=$conditions.split("|");for(var i=0,length=conditionslist.length;i<length;i++){$condition=conditionslist[i];var cd=$condition.split("=");var c=cd[0];var v=cd[1];if(v&&v.length&&c&&c.length){var $q=$f.find("#"+c);var el=$q.find("[data-code='"+v+"']");conditionFullfilled=(el.is("option:selected,input[type='radio']:checked,input[type='checkbox']:checked"))?true:false;}}}else conditionFullfilled=true;if(conditionFullfilled){$question.addClass("visible");if($question.hasClass('dgt-quest-epilog'))$.proxy($f.trigger("submit"),this);return false;}else $question.removeClass("visible");});}}},check_changeHandler:function(event,isBounce){if(this.$paginate){var $elm=$(event.currentTarget);var $q=$elm.closest(".dgt-quest-question");($q.find(":radio:checked,:checkbox:checked").length>0)?showNext($q):hideNext($q);}else this.refresh_questions();},select_changeHandler:function(event,isBounce){if(this.$paginate){var $elm=$(event.currentTarget);var $q=$elm.closest(".dgt-quest-question");($elm.val())?showNext($q):hideNext($q);}else this.refresh_questions();},inputText_changeHandler:function(event){if(this.$paginate){event.stopPropagation();var $elm=$(event.currentTarget);var $q=$elm.closest(".dgt-quest-question");($elm.val().length>0)?showNext($q):hideNext($q);}},refresh_questions:function(){if(!this.$paginate){$f=this.$form;this.$questions.each(function(i,question){$question=$(question);$conditions=$question.data("condition");if($conditions&&($conditions.length>0)&&($conditions.charAt(0)!="$")){var conditionslist=$conditions.split("|");var conditionFullfilled=false;for(var i=0,length=conditionslist.length;i<length;i++){$condition=conditionslist[i];var cd=$condition.split("=");var c=cd[0];var v=cd[1];if(v&&v.length&&c&&c.length){var $q=$f.find("#"+c);var el=$q.find("[data-code='"+v+"']");conditionFullfilled=(el.is("option:selected,input[type='radio']:checked,input[type='checkbox']:checked"))?true:false;}}if(conditionFullfilled){$question.addClass("visible").addClass("sub");}else{$question.removeClass("visible");resetFormElements($question);}}else $question.addClass("visible");});}},});})();(function(){$(window).on('digital:contentReady',function(event,node){$(node).find('.dgt-slider').each(function(i,node){new Dgt_Slider(node);});});var Dgt_Slider=function(){this.initialize.apply(this,arguments);};$.extend(Dgt_Slider.prototype,{config:{waitDuration:8000,restartDuration:10000,enterDuration:500,leaveDuration:700,},initialize:function(el){this.el=el;this.$el=$(el).data('Dgt_Slider',this);this.uid=_.uniqueId('digital-');this.$page=this.$el.closest('.page,#head');this.$el.on('afterChange',$.proxy(this.afterChangeHandler,this));this.$slides=this.$el.find('.slide');var thumbs='<ul class="thumbs">';this.$slides.each(function(i,slide){thumbs+='<li><a href="javascript:void(0)">';thumbs+=$(slide).find('h2').text();thumbs+='</a></li>';});thumbs+='</ul>';this.$el.append(thumbs);this.$thumbs=this.$el.find('.thumbs a');this.$thumbs.on('click',$.proxy(this.thumb_clickHandler,this));this.currentIndex=-1;this.play();},dispose:function(){this.$el.stop('dgtSliderWait');this.$el.stop('dgtSliderRestart');this.$slides.stop('dgtSliderEnter');this.$slides.stop('dgtSliderLeave');},thumb_clickHandler:function(event){event.preventDefault();var index=$.inArray(event.currentTarget,this.$thumbs);if(index==this.currentIndex)return;this.pause();this.setIndex(index);},play:function(){this.playing=true;this.next();},pause:function(){this.playing=false;},afterChangeHandler:function(){if(this.playing){this.$el.animate({dgtSlider:0},{queue:'dgtSliderWait',duration:this.config.waitDuration,complete:$.proxy(this.next,this)}).dequeue('dgtSliderWait');}else{this.$el.animate({dgtSlider:0},{queue:'dgtSliderRestart',duration:this.config.restartDuration,complete:$.proxy(this.play,this)}).dequeue('dgtSliderRestart');}},next:function(){var index=this.currentIndex+1;if(index>=this.$slides.length)index=0;this.setIndex(index);},setIndex:function(index){this.i=this.i?++this.i:1;var i=this.i;var oldIndex=this.currentIndex;if(oldIndex==index)return;this.currentIndex=index;this.$thumbs.removeClass('is-current');this.$thumbs.eq(index).addClass('is-current');if(oldIndex>=0){var $oldSlide=this.$slides.eq(oldIndex);$oldSlide.finish('dgtSliderEnter');$oldSlide.addClass('leave');$oldSlide.animate({dgtSlider:0},{queue:'dgtSliderLeave',duration:this.config.leaveDuration,start:$.proxy(function(){$oldSlide.addClass('leave-active');},this),complete:$.proxy(function(){$oldSlide.removeClass('leave leave-active is-current');},this)}).dequeue('dgtSliderLeave');}var $newSlide=this.$slides.eq(index);$newSlide.finish('dgtSliderLeave');$newSlide.addClass('enter');$newSlide.animate({dgtSlider:0},{queue:'dgtSliderEnter',duration:oldIndex>=0?this.config.leaveDuration:1,});$newSlide.animate({dgtSlider:0},{queue:'dgtSliderEnter',duration:this.config.enterDuration,start:$.proxy(function(){$newSlide.addClass('enter-active');},this),complete:$.proxy(function(){$newSlide.removeClass('enter enter-active');$newSlide.addClass('is-current');this.$el.trigger('afterChange');},this)}).dequeue('dgtSliderEnter');this.$el.stop('dgtSliderWait');this.$el.stop('dgtSliderRestart');}});})();(function(){$(window).on('digital:contentReady',function(event,node){$(node).find('.block.promo').each(function(i,promo){var $promo=$(promo);function togglePromo(p){if($.cookie("bp")==1){$promo.removeClass("collapse");$.cookie("bp",0,{path:'/'});}else{$promo.addClass("collapse");$.cookie("bp",1,{path:'/'});}}$promo.children("a.close").first().on('click',function(e){e.preventDefault();e.stopPropagation();togglePromo($promo);});if($.cookie("bp")==1)$promo.addClass("collapse");else $promo.removeClass("collapse");});});})();